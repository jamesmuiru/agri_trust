{% extends 'base.html' %}

{% block title %}Fresh Produce - AgriTrust{% endblock %}

{% block content %}
<style>
    .page-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin: 2rem 0;
        flex-wrap: wrap;
        gap: 1rem;
    }

    .filters {
        background: white;
        padding: 1.5rem;
        border-radius: 8px;
        margin-bottom: 2rem;
        box-shadow: 0 2px 4px rgba(0,0,0,0.1);
    }

    .filter-grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
        gap: 1rem;
    }

    .filter-group {
        display: flex;
        flex-direction: column;
    }

    .filter-label {
        font-weight: 500;
        margin-bottom: 0.5rem;
        color: #333;
    }

    .filter-select {
        padding: 0.75rem;
        border: 1px solid #ddd;
        border-radius: 4px;
        font-size: 1rem;
        background: white;
    }

    .filter-button {
        align-self: end;
    }

    .produce-grid {
        display: grid;
        grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
        gap: 2rem;
        margin: 2rem 0;
    }

    .produce-card {
        background: white;
        border-radius: 12px;
        overflow: hidden;
        box-shadow: 0 4px 6px rgba(0,0,0,0.1);
        transition: transform 0.3s, box-shadow 0.3s;
    }

    .produce-card:hover {
        transform: translateY(-5px);
        box-shadow: 0 8px 15px rgba(0,0,0,0.15);
    }

    .produce-image {
        width: 100%;
        height: 200px;
        background: linear-gradient(135deg, #f0f0f0 0%, #e0e0e0 100%);
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 4rem;
    }

    .produce-content {
        padding: 1.5rem;
    }

    .produce-title {
        font-size: 1.3rem;
        color: #2e7d32;
        margin-bottom: 0.5rem;
    }

    .produce-price {
        color: #2e7d32;
        font-size: 1.4rem;
        font-weight: bold;
        margin: 0.5rem 0;
    }

    .produce-meta {
        display: flex;
        justify-content: space-between;
        color: #666;
        font-size: 0.9rem;
        margin-top: 1rem;
        padding-top: 1rem;
        border-top: 1px solid #eee;
    }

    .badge {
        padding: 0.25rem 0.75rem;
        border-radius: 20px;
        font-size: 0.8rem;
        font-weight: 500;
        display: inline-block;
        margin-bottom: 0.5rem;
    }

    .badge-grade-A { background: #4caf50; color: white; }
    .badge-grade-B { background: #ff9800; color: white; }
    .badge-grade-C { background: #f44336; color: white; }
    .badge-type { background: #e3f2fd; color: #1976d2; }

    .quantity-info {
        background: #f8f9fa;
        padding: 0.5rem;
        border-radius: 4px;
        margin: 0.5rem 0;
        text-align: center;
    }

    .farmer-info {
        color: #666;
        font-style: italic;
        margin: 0.5rem 0;
    }

    @media (max-width: 768px) {
        .page-header {
            flex-direction: column;
            align-items: stretch;
        }
        
        .filter-grid {
            grid-template-columns: 1fr;
        }
        
        .produce-grid {
            grid-template-columns: 1fr;
        }
    }
</style>

<div class="page-header">
    <h1>Fresh Produce Marketplace</h1>
    {% if user.is_authenticated and user.userprofile.user_type == 'farmer' %}
        <a href="{% url 'add-produce-page' %}" class="btn btn-primary">+ Add New Produce</a>
    {% endif %}
</div>

<div class="filters">
    <div class="filter-grid">
        <div class="filter-group">
            <label class="filter-label">Produce Type</label>
            <select class="filter-select">
                <option value="">All Types</option>
                <option value="vegetables">Vegetables</option>
                <option value="fruits">Fruits</option>
                <option value="grains">Grains</option>
                <option value="legumes">Legumes</option>
                <option value="tubers">Tubers</option>
            </select>
        </div>
        
        <div class="filter-group">
            <label class="filter-label">Location</label>
            <select class="filter-select">
                <option value="">All Locations</option>
                <option value="nairobi">Nairobi</option>
                <option value="kiambu">Kiambu</option>
                <option value="nakuru">Nakuru</option>
                <option value="mombasa">Mombasa</option>
            </select>
        </div>
        
        <div class="filter-group">
            <label class="filter-label">Quality Grade</label>
            <select class="filter-select">
                <option value="">All Grades</option>
                <option value="A">Grade A - Premium</option>
                <option value="B">Grade B - Standard</option>
                <option value="C">Grade C - Basic</option>
            </select>
        </div>
        
        <div class="filter-group">
            <label class="filter-label">&nbsp;</label>
            <button class="btn btn-primary filter-button">Apply Filters</button>
        </div>
    </div>
</div>

<div class="produce-grid">
    {% for produce in produces %}
    <div class="produce-card">
        <div class="produce-image">
            {% if produce.produce_type == 'vegetables' %}ü•¶
            {% elif produce.produce_type == 'fruits' %}üçé
            {% elif produce.produce_type == 'grains' %}üåæ
            {% elif produce.produce_type == 'legumes' %}ü•ú
            {% else %}ü•î{% endif %}
        </div>
        
        <div class="produce-content">
            <h3 class="produce-title">{{ produce.name }}</h3>
            
            <div class="badge badge-type">{{ produce.get_produce_type_display }}</div>
            <div class="badge badge-grade-{{ produce.quality_grade }}">
                Grade {{ produce.quality_grade }}
            </div>
            
            <p class="produce-price">KSh {{ produce.price_per_unit }} / {{ produce.unit }}</p>
            
            <div class="quantity-info">
                {{ produce.quantity }} {{ produce.unit }} available
            </div>
            
            <p class="farmer-info">
                From: {{ produce.farmer.get_full_name|default:produce.farmer.username }} in {{ produce.farmer.userprofile.location }}
            </p>
            
            <p>{{ produce.description|truncatewords:20 }}</p>
            
            <div class="produce-meta">
                <span>Harvested: {{ produce.harvest_date }}</span>
                <span>Expires: {{ produce.expiry_date }}</span>
            </div>
            
            {% if user.is_authenticated and user.userprofile.user_type == 'buyer' %}
                <a href="{% url 'create-order-page' produce.id %}" class="btn btn-primary" style="width: 100%; margin-top: 1rem;">
                    Order Now
                </a>
            {% elif not user.is_authenticated %}
                <a href="{% url 'login-page' %}" class="btn btn-secondary" style="width: 100%; margin-top: 1rem;">
                    Login to Order
                </a>
            {% endif %}
        </div>
    </div>
    {% empty %}
    <div class="card" style="grid-column: 1 / -1; text-align: center; padding: 3rem;">
        <h3>No produce available at the moment</h3>
        <p>Check back later for fresh farm produce listings</p>
    </div>
    {% endfor %}
</div>

<script>
    document.addEventListener('DOMContentLoaded', function() {
        const filterSelects = document.querySelectorAll('.filter-select');
        const filterButton = document.querySelector('.filter-button');
        
        filterButton.addEventListener('click', function() {
            const filters = {};
            filterSelects.forEach(select => {
                const name = select.previousElementSibling.textContent.toLowerCase().replace(' ', '_');
                filters[name] = select.value;
            });
            
            // Here you would typically make an API call or redirect with filter parameters
            console.log('Applying filters:', filters);
            alert('Filter functionality would be implemented here');
        });
    });
</script>
{% endblock %}